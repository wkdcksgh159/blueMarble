<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>sample</title>
<style>
   td{
      font-size:9px;
      width: 150px;
       height: 80px;
       text-align:center;
   }
   .gold {
      font-size:20px;
      font-type:bold;
   }
</style>
</head>
<link rel="stylesheet" href="/BlueMarble/css/jquery-ui.css">
<script src="/BlueMarble/script/jquery-3.4.1.min.js"></script>
<script src="/BlueMarble/script/jquery-ui.js"></script>
<script src="/BlueMarble/script/player.js"></script>
<script src="/BlueMarble/script/city.js"></script>
<body>
<h3>
   부루마블
  <button type="button" id="diceBtn">King Dice!</button>
   현재 플레이어 : <input type="text" id="player" value="">
   주사위 값 : <input type="text" id="diceValue" value="">
   이동지점 : <input type="text" id="point" value="">
</h3>
<div id="allPlayer">
</div>
<table border="1">
   <tr>
   	  <!-- 나라태그, player:땅의 주인을 확인하는 클래스, city:도시의 이름을 확인하는 클래스, gold:도시의 가격을 확인하는 클래스 주인이없으면 땅값이 출력 -->
      <td id="p1"><div class="player">0</div>Start<div class="gold">1</div><div id="btn"></div></td>
      <td id="p2"><div class="player">0</div><div class="city">타이페이</div><div class="gold">50000</div></td>
      <td id="p3"><div class="player">0</div><div class="event">황금열쇠</div><div class="gold">3</div></td>
      <td id="p4"><div class="player">0</div><div class="city">베이징</div><div class="gold">80000</div></td>
      <td id="p5"><div class="player">0</div><div class="city">마닐라</div><div class="gold">80000</div></td>
      <td id="p6"><div class="player">0</div><div class="city">제주도</div><div class="gold">200000</div></td>
      <td id="p7"><div class="player">0</div><div class="city">싱가포르</div><div class="gold">100000</div></td>
      <td id="p8"><div class="player">0</div><div class="event">황금열쇠</div><div class="gold">8</div></td>
      <td id="p9"><div class="player">0</div><div class="city">카이로</div><div class="gold">100000</div></td>
      <td id="p10"><div class="player">0</div><div class="city">이스탄불</div><div class="gold">120000</div></td>
      <td id="p11"><div class="player">0</div><div class="event">무인도</div><div class="gold">11</div></td>
   </tr>
   <tr>
      <td id="p40"><div class="player">0</div><div class="city">서울</div><div class="gold">1000000</div></td>
      <td rowspan="9" colspan="9"> </td>
      <td id="p12"><div class="player">0</div><div class="city">아테네</div><div class="gold">140000</div></td>
   </tr>
   <tr>
      <td id="p39"><div class="player">0</div><div class="event">사회복지기금(받는곳)</div><div class="gold">39</div></td>
      
      <td id="p13"><div class="player">0</div><div class="event">황금열쇠</div><div class="gold">13</div></td>
   </tr>
   <tr>
      <td id="p38"><div class="player">0</div><div class="city">뉴욕</div><div class="gold">350000</div></td>
      
      <td id="p14"><div class="player">0</div><div class="city">코펜하겐</div><div class="gold">160000</div></td>
   </tr>
   <tr>
      <td id="p37"><div class="player">0</div><div class="city">런던</div><div class="gold">350000</div></td>
      
      <td id="p15"><div class="player">0</div><div class="city">스톡홀름</div><div class="gold">160000</div></td>
   </tr>
   <tr>
      <td id="p36"><div class="player">0</div><div class="event">황금열쇠</div><div class="gold">36</div></td>
      
      <td id="p16"><div class="player">0</div><div class="city">콩코드여객기</div><div class="gold">200000</div></td>
   </tr>
   <tr>
      <td id="p35"><div class="player">0</div><div class="city">로마</div><div class="gold">320000</div></td>
      
      <td id="p17"><div class="player">0</div><div class="city">베른</div><div class="gold">180000</div></td>
   </tr>
   <tr>
      <td id="p34"><div class="player">0</div><div class="city">파리</div><div class="gold">320000</div></td>
      
      <td id="p18"><div class="player">0</div><div class="event">황금열쇠</div><div class="gold">18</div></td>
   </tr>
   <tr>
      <td id="p33"><div class="player">0</div><div class="city">콜럼비아호</div><div class="gold">450000</div></td>
      
      <td id="p19"><div class="player">0</div><div class="city">베를린</div><div class="gold">180000</div></td>
   </tr>
   <tr>
      <td id="p32"><div class="player">0</div><div class="city">도쿄</div><div class="gold">300000</div></td>
      
      <td id="p20"><div class="player">0</div><div class="city">오타와</div><div class="gold">200000</div></td>
   </tr>1
   <tr>
      <td id="p31"><div class="player">0</div><div class="event">우주여행</div><div class="gold">31</div></td>
      <td id="p30"><div class="player">0</div><div class="city">마드리드</div><div class="gold">280000</div></td>
      <td id="p29"><div class="player">0</div><div class="city">퀸엘리자베스호</div><div class="gold">300000</div></td>
      <td id="p28"><div class="player">0</div><div class="city">리스본</div><div class="gold">260000</div></td>
      <td id="p27"><div class="player">0</div><div class="city">하와이</div><div class="gold">260000</div></td>
      <td id="p26"><div class="player">0</div><div class="city">부산</div><div class="gold">500000</div></td>
      <td id="p25"><div class="player">0</div><div class="city">시드니</div><div class="gold">240000</div></td>
      <td id="p24"><div class="player">0</div><div class="city">쌍파울로</div><div class="gold">240000</div></td>
      <td id="p23"><div class="player">0</div><div class="event">황금열쇠</div><div class="gold">23</div></td>
      <td id="p22"><div class="player">0</div><div class="city">부에노스아이레스</div><div class="gold">220000</div></td>
      <td id="p21"><div class="player">0</div><div class="event">사회복지기금(주는곳)</div><div class="gold">21</div></td>
   </tr>
</table>
<!-- dialog태그 넣는곳 -->
<div id="dialogTag">
</div>
-->
</body>
<script>
   $(document).ready(function(){
	  $("#diceBtn").attr("disabled", true);
	  //인원수 파악
	  start = false;
	  let allPlayer = "";
	  while(start == false) {
		  allPlayer = prompt("몇명이서 플레이합니까? (1~4까지의 숫자만 입력가능)");
		  if(allPlayer > 0 && allPlayer < 5){
			  alert("게임시작")
			  $("#diceBtn").attr("disabled", false);
			  start = true;
		  } else {
			  alert("다시입력")
			  start = false;
		  }
	  }
	  //플레이어
      let player = 0;
	  
	  gamer = [Player1, Player2, Player3, Player4];
	  
	  gamer.splice(player,1);
	  console.log(gamer);
	  gamer.slice(0, allPlayer);
	  //플레이어 수 만큼 돈, 이미지 세팅
	  for(i=1; i < parseInt(allPlayer)+1; i++){
		  let playerMoneyHtml = "플레이어"+i+" 돈 : <input type='text' id='player"+i+"money' value='3000000'>";
		  $("#allPlayer").append(playerMoneyHtml);
	  }
	  for(i=1; i < parseInt(allPlayer)+1; i++){
		  let playerHtml = "<img class='btn-danger"+i+"' src='/jquery-prac/image/pic0"+i+".jpg'>";
		  $("#btn").append(playerHtml);
	  }
	  
      //주사위 클릭시
      $("#diceBtn").click(function(){
    	 let dialogHtml = "<div id='dialog' title='도시이름'>대지 <input type='radio' name='build' id='land' checked='checked'><span id='landToll'></span><br>별장 <input type='radio' name='build' id='villa'><span id='villaToll'></span><br>빌딩 <input type='radio' name='build' id='building'><span id='buildingToll'></span><br>호텔 <input type='radio' name='build' id='hotel'><span id='hotelToll'></span><br><button type='button' id='buy'>구매</button><button type='button' id='cancel'>취소</button></div>";
    	 $("#dialogTag").append(dialogHtml);
    	 //주사위 세팅(1~6까지 숫자 랜덤)
         let ran1 = Math.floor(Math.random()*6+1);
    	 console.log("ran1 : ", ran1);
         let ran2 = Math.floor(Math.random()*6+1);
         console.log("ran2 : ", ran2);
         ran = ran1+ran2
         $("#diceValue").val(ran);
         
         currentGamer = gamer[player];
         
         $("#player").val(currentGamer.player);
         console.log("currentGamer : ",currentGamer);
         $("#player"+currentGamer.player+"money").val(currentGamer.money);
            //주사위를 굴렸을때 이동지점
            if(currentGamer.beforePoint+ran < 41){
            	currentGamer.afterPoint = currentGamer.beforePoint+ran;
            } else {
            	currentGamer.afterPoint = currentGamer.beforePoint+ran-40;
            }
            $("#point").val(currentGamer.afterPoint);
            //이동한 지점에 유저 버튼 생성
            let html = "<img class='btn-danger"+currentGamer.player+"' src='/jquery-prac/image/pic0"+currentGamer.player+".jpg'>";
            currentGamer.beforeId = "#p"+currentGamer.beforePoint;
            currentGamer.afterId = "#p"+currentGamer.afterPoint;
            console.log("currentGamer.afterId : ", currentGamer.afterId);
            $(currentGamer.afterId).append(html);
            $(currentGamer.beforeId).find(".btn-danger"+currentGamer.player).remove();
            currentGamer.beforePoint = currentGamer.afterPoint;
            //밟은 땅 주인 체크
            if($(currentGamer.afterId).find(".player").text() == 0){
            	console.log("밟은땅 위치", currentGamer.afterId);
            	cityName = $(currentGamer.afterId).find(".city").text();
            	console.log("cityName : ", cityName);
            	let city = "";
            	switch(cityName){
            		case "타이페이":
            			city = 타이페이;
            			break;
	            	case "베이징":
	            		city = 베이징;
	            		break;
	            	case "마닐라":
            			city = 마닐라;
            			break;
	            	case "제주도":
	            		city = 제주도;
	            		break;
	            	case "싱가포르":
            			city = 싱가포르;
            			break;
	            	case "카이로":
	            		city = 카이로;
	            		break;
	            	case "이스탄불":
	            		city = 이스탄불;
	            		break;
	            	case "아테네":
	            		city = 아테네;
	            		break;
	            	case "코펜하겐":
	            		city = 코펜하겐;
	            		break;
	            	case "스톡홀름":
	            		city = 스톡홀름;
	            		break;
	            	case "콩코드여객기":
	            		city = 콩코드여객기;
	            		break;
	            	case "베른":
	            		city = 베른;
	            		break;
	            	case "베를린":
	            		city = 베를린;
	            		break;
	            	case "오타와":
	            		city = 오타와;
	            		break;
	            	case "부에노스아이레스":
	            		city = 부에노스아이레스;
	            		break;
	            	case "상파울로":
	            		city = 상파울로;
	            		break;
	            	case "시드니":
	            		city = 시드니;
	            		break;
	            	case "부산":
	            		city = 부산;
	            		break;
	            	case "하와이":
	            		city = 하와이;
	            		break;
	            	case "리스본":
	            		city = 리스본;
	            		break;
	            	case "퀸엘리자베스호":
	            		city = 퀸엘리자베스호;
	            		break;
	            	case "마드리드":
	            		city = 마드리드;
	            		break;		
	            	case "도쿄":
	            		city = 도쿄;
	            		break;
	            	case "콜럼비아호":
	            		city = 콜럼비아호;
	            		break;
	            	case "파리":
	            		city = 파리;
	            		break;
	            	case "로마":
	            		city = 로마;
	            		break;	
	            	case "런던":
	            		city = 런던;
	            		break;		
	            	case "뉴욕":
	            		city = 뉴욕;
	            		break;		
	            	case "서울":
	            		city = 서울;
	            		break;
	            	default:
	            		city = null;
	            		break;
            	}
            	console.log("city : ", city);
            	if(city != null){
            		//땅 구매여부를 선택할때까지 주사위 비활성화
                	$("#diceBtn").attr("disabled", true);
                	$("#dialog").dialog({
                		closeOnEscape: false,
                	    open: function(event, ui) {
                	            $(".ui-dialog-titlebar-close", $(this).parent()).hide();
                	    }
                	});
                	if(city == 제주도 || city == 콩코드여객기 || city == 부산 || city == 퀸엘리자베스호 || city == 콜럼비아호 || city == 서울){
                		$("#villa").attr("disabled", true);
                		$("#building").attr("disabled", true);
                		$("#hotel").attr("disabled", true);
                	} else {
                		$("#villa").attr("disabled", false);
                		$("#building").attr("disabled", false);
                		$("#hotel").attr("disabled", false);
                	}
                	$("#landToll").text(" 통행료 "+ city.대지료통행시+"원");
                	$("#villaToll").text(" 통행료 "+ city.별장통행시+"원");
                	$("#buildingToll").text(" 통행료 "+ city.빌딩통행시+"원");
                	$("#hotelToll").text(" 통행료 "+ city.호텔통행시+"원");
                	$("#buy").click(function(){
                		console.log("현재 gamer : ", currentGamer);
                		console.log("구매 위치", currentGamer.afterId);
                		console.log("buy 클릭 실행!");
                		console.log("buy player : ", currentGamer.player);
                		if($('input[name="build"]:checked').is("#land")){
                			console.log("땅 구매 : ", currentGamer.player);
                			//땅 주인 세팅 (플레이어1 이면 1 이 들어감)
                            $(currentGamer.afterId).find(".player").text(currentGamer.player);
                          	//주인이없으면 땅 가격 세팅
                          	$(currentGamer.afterId).find(".gold").text(city.대지료통행시);
                          	console.log("대지료구매 전 머니", currentGamer.money);
                          	console.log("구매료 : ", city.대지료구매);
                          	currentGamer.money = currentGamer.money-city.대지료구매;
                          	console.log("대지료구매 후 머니", currentGamer.money);
                          	$("#player"+currentGamer.player+"money").val(currentGamer.money);
                		}
                		if($('input[name="build"]:checked').is("#villa")){
                			//별장 주인 세팅 (플레이어1 이면 1 이 들어감)
                            $(currentGamer.afterId).find(".player").text(currentGamer.player);
                            //주인이없으면 별장 가격 세팅
                            $(currentGamer.afterId).find(".gold").text(city.별장통행시);
                            console.log("별장구매 전 머니", currentGamer.money);
                            console.log("구매료 : ", city.대지료구매+city.별장구매);
                          	currentGamer.money = currentGamer.money-city.대지료구매-city.별장구매;
                          	console.log("별장구매 후 머니", currentGamer.money);
                          	$("#player"+currentGamer.player+"money").val(currentGamer.money);
                          	
                		}
                		if($('input[name="build"]:checked').is("#building")){
                			//빌딩 주인 세팅 (플레이어1 이면 1 이 들어감)
                            $(currentGamer.afterId).find(".player").text(currentGamer.player);
                            //주인이없으면 빌딩 가격 세팅
                            $(currentGamer.afterId).find(".gold").text(city.빌딩통행시);
                            console.log("빌딩구매 전 머니", currentGamer.money);
                            console.log("구매료 : ", city.대지료구매+city.빌딩구매);
                          	currentGamer.money = currentGamer.money-city.대지료구매-city.빌딩구매;
                          	console.log("빌딩구매 후 머니", currentGamer.money);
                          	$("#player"+currentGamer.player+"money").val(currentGamer.money);
                		}
                		if($('input[name="build"]:checked').is("#hotel")){
                			//호텔 주인 세팅 (플레이어1 이면 1 이 들어감)
                            $(currentGamer.afterId).find(".player").text(currentGamer.player);
                            //호텔 가격 세팅
                            $(currentGamer.afterId).find(".gold").text(city.호텔통행시);
                            console.log("호텔구매 전 머니", currentGamer.money);
                            console.log("구매료 : ", city.대지료구매+city.호텔구매);
                          	currentGamer.money = currentGamer.money-city.대지료구매-city.호텔구매;
                          	console.log("호텔구매 후 머니", currentGamer.money);
                          	$("#player"+currentGamer.player+"money").val(currentGamer.money);
                		}
                        //주사위 활성화
                		$("#diceBtn").attr("disabled", false);
                        //dialog 닫기
                		$("#dialog").dialog("close");
                		$("#dialog").remove();
                	})
                	$("#cancel").click(function(){
                		//dialog 닫기
                		$("#diceBtn").attr("disabled", false);
                		$("#dialog").dialog("close");
                		$("#dialog").remove();
                	});
            	} else {
            		event = $(currentGamer.afterId).find(".event").text();
            		switch(event){
	            		case "황금열쇠":
	            			console.log("황금열쇠 도착!");
	            			break;
	            		case "사회복지기금(주는곳)":
	            			console.log("사회복지기금(주는곳) 도착!");
	            			break;
	            		case "사회복지기금(받는곳)":
	            			console.log("사회복지기금(받는곳) 도착!");
	            			break;
	            		case "무인도":
	            			console.log("무인도 도착!");
	            			break;
	            		case "우주여행":
	            			console.log("우주여행 도착!");
	            			break;
            		}
            		$("#dialog").remove();
            	}
            } else {
               //주인이 있으면 땅 가격만큼 가진 돈에서 차감
               console.log("결제 전 머니: ", currentGamer.money);
               currentGamer.money = currentGamer.money-($(currentGamer.afterId).find(".gold").text());
               console.log("결제 후 머니: ", currentGamer.money);
               $("#player"+currentGamer.player+"money").val(currentGamer.money);
               $("#dialog").remove();
            }
            // 플레이어 변경
            if(ran1 != ran2){
           	 	player++;
           	 if(player>gamer.length){
           		 console.log("allPlayer : ", allPlayer);
               	 player = player-gamer.length;
             }
            } else {
           	 console.log("더블!");
            }
      });
   });
</script>
</html>