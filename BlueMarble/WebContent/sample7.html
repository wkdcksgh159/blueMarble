<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>sample</title>
<style>
   td{
      font-size:9px;
      width: 150px;
       height: 80px;
       text-align:center;
   }
   .gold {
      font-size:20px;
      font-type:bold;
   }
   #dialog {
   	  display:none;
   }
   .placePoint {
      display:none;
   }
</style>
</head>
<link rel="stylesheet" href="/BlueMarble/css/jquery-ui.css">
<script src="/BlueMarble/script/jquery-3.4.1.min.js"></script>
<script src="/BlueMarble/script/jquery-ui.js"></script>
<script src="/BlueMarble/script/player.js"></script>
<script src="/BlueMarble/script/city.js"></script>
<script src="/BlueMarble/script/function.js"></script>
<body>
<h3>
   부르마블
   <button type="button" id="diceBtn">King Dice!</button>
   현재 플레이어 : <input type="text" id="player" value="">
   주사위 값 : <input type="text" id="diceValue" value="">
   이동지점 : <input type="text" id="point" value="">
</h3>
<div id="allPlayer">
</div>
<table border="1">
   <tr>
   	  <!-- 나라태그, player:땅의 주인을 확인하는 클래스, city:도시의 이름을 확인하는 클래스, gold:도시의 가격을 확인하는 클래스 주인이없으면 땅값이 출력 -->
      <td id="p1" class="place"><div class="placePoint">1</div><div class="player">0</div>Start<div class="gold">1</div><div id="btn"></div></td>
      <td id="p2" class="place"><div class="placePoint">2</div><div class="player">0</div><div class="city">타이페이</div><div class="gold">50000</div></td>
      <td id="p3" class="place"><div class="placePoint">3</div><div class="player">0</div><div class="event">황금열쇠</div><div class="gold">3</div></td>
      <td id="p4" class="place"><div class="placePoint">4</div><div class="player">0</div><div class="city">베이징</div><div class="gold">80000</div></td>
      <td id="p5" class="place"><div class="placePoint">5</div><div class="player">0</div><div class="city">마닐라</div><div class="gold">80000</div></td>
      <td id="p6" class="place"><div class="placePoint">6</div><div class="player">0</div><div class="city">제주도</div><div class="gold">200000</div></td>
      <td id="p7" class="place"><div class="placePoint">7</div><div class="player">0</div><div class="city">싱가포르</div><div class="gold">100000</div></td>
      <td id="p8" class="place"><div class="placePoint">8</div><div class="player">0</div><div class="event">황금열쇠</div><div class="gold">8</div></td>
      <td id="p9" class="place"><div class="placePoint">9</div><div class="player">0</div><div class="city">카이로</div><div class="gold">100000</div></td>
      <td id="p10" class="place"><div class="placePoint">10</div><div class="player">0</div><div class="city">이스탄불</div><div class="gold">120000</div></td>
      <td id="p11" class="place"><div class="placePoint">11</div><div class="player">0</div><div class="event">무인도</div><div class="gold">11</div></td>
   </tr>
   <tr>
      <td id="p40" class="place"><div class="placePoint">40</div><div class="player">0</div><div class="city">서울</div><div class="gold">1000000</div></td>
      <td rowspan="9" colspan="9"> </td>
      <td id="p12" class="place"><div class="placePoint">12</div><div class="player">0</div><div class="city">아테네</div><div class="gold">140000</div></td>
   </tr>
   <tr>
      <td id="p39" class="place"><div class="placePoint">39</div><div class="player">0</div><div class="event">사회복지기금(내는곳)</div><div class="gold">150000</div></td>
      
      <td id="p13" class="place"><div class="placePoint">13</div><div class="player">0</div><div class="event">황금열쇠</div><div class="gold">13</div></td>
   </tr>
   <tr>
      <td id="p38" class="place"><div class="placePoint">38</div><div class="player">0</div><div class="city">뉴욕</div><div class="gold">350000</div></td>
      
      <td id="p14" class="place"><div class="placePoint">14</div><div class="player">0</div><div class="city">코펜하겐</div><div class="gold">160000</div></td>
   </tr>
   <tr>
      <td id="p37" class="place"><div class="placePoint">37</div><div class="player">0</div><div class="city">런던</div><div class="gold">350000</div></td>
      
      <td id="p15" class="place"><div class="placePoint">15</div><div class="player">0</div><div class="city">스톡홀름</div><div class="gold">160000</div></td>
   </tr>
   <tr>
      <td id="p36" class="place"><div class="placePoint">36</div><div class="player">0</div><div class="event">황금열쇠</div><div class="gold">36</div></td>
      
      <td id="p16" class="place"><div class="placePoint">16</div><div class="player">0</div><div class="city">콩코드여객기</div><div class="gold">200000</div></td>
   </tr>
   <tr>
      <td id="p35" class="place"><div class="placePoint">35</div><div class="player">0</div><div class="city">로마</div><div class="gold">320000</div></td>
      
      <td id="p17" class="place"><div class="placePoint">17</div><div class="player">0</div><div class="city">베른</div><div class="gold">180000</div></td>
   </tr>
   <tr>
      <td id="p34" class="place"><div class="placePoint">34</div><div class="player">0</div><div class="city">파리</div><div class="gold">320000</div></td>
      
      <td id="p18" class="place"><div class="placePoint">18</div><div class="player">0</div><div class="event">황금열쇠</div><div class="gold">18</div></td>
   </tr>
   <tr>
      <td id="p33" class="place"><div class="placePoint">33</div><div class="player">0</div><div class="city">콜럼비아호</div><div class="gold">450000</div></td>
      
      <td id="p19" class="place"><div class="placePoint">19</div><div class="player">0</div><div class="city">베를린</div><div class="gold">180000</div></td>
   </tr>
   <tr>
      <td id="p32" class="place"><div class="placePoint">32</div><div class="player">0</div><div class="city">도쿄</div><div class="gold">300000</div></td>
      
      <td id="p20" class="place"><div class="placePoint">20</div><div class="player">0</div><div class="city">오타와</div><div class="gold">200000</div></td>
   </tr>
   <tr>
      <td id="p31" class="place"><div class="placePoint">31</div><div class="player">0</div><div class="event">우주여행</div><div class="gold">31</div></td>
      <td id="p30" class="place"><div class="placePoint">30</div><div class="player">0</div><div class="city">마드리드</div><div class="gold">280000</div></td>
      <td id="p29" class="place"><div class="placePoint">29</div><div class="player">0</div><div class="city">퀸엘리자베스호</div><div class="gold">300000</div></td>
      <td id="p28" class="place"><div class="placePoint">28</div><div class="player">0</div><div class="city">리스본</div><div class="gold">260000</div></td>
      <td id="p27" class="place"><div class="placePoint">27</div><div class="player">0</div><div class="city">하와이</div><div class="gold">260000</div></td>
      <td id="p26" class="place"><div class="placePoint">26</div><div class="player">0</div><div class="city">부산</div><div class="gold">500000</div></td>
      <td id="p25" class="place"><div class="placePoint">25</div><div class="player">0</div><div class="city">시드니</div><div class="gold">240000</div></td>
      <td id="p24" class="place"><div class="placePoint">24</div><div class="player">0</div><div class="city">상파울로</div><div class="gold">240000</div></td>
      <td id="p23" class="place"><div class="placePoint">23</div><div class="player">0</div><div class="event">황금열쇠</div><div class="gold">23</div></td>
      <td id="p22" class="place"><div class="placePoint">22</div><div class="player">0</div><div class="city">부에노스아이레스</div><div class="gold">220000</div></td>
      <td id="p21" class="place"><div class="placePoint">21</div><div class="player">0</div><div class="event">사회복지기금(받는곳)</div><div class="gold">21</div></td>
   </tr>
</table>
<!-- dialog태그 넣는곳 -->
<div id="dialogTag">
</div>
<div id="dialog" title='도시이름'>
	<div id='landDiv'>대지 <input type='radio' name='build' id='land' checked='checked'><span id='landToll'></span></div>
	<div id='villaDiv'>별장 <input type='radio' name='build' id='villa'><span id='villaToll'></span></div>
	<div id='buildingDiv'>빌딩 <input type='radio' name='build' id='building'><span id='buildingToll'></span></div>
	<div id='hotelDiv'>호텔 <input type='radio' name='build' id='hotel'><span id='hotelToll'></span></div>
	<button type='button' id='buy'>구매</button>
	<button type='button' id='cancel'>취소</button></div>
</body>
<script>
   $(document).ready(function(){
	 //플레이어 초기화
      let player = 1;
	  $("#diceBtn").attr("disabled", true);
	  //인원수 파악
	  start = false;
	  let allPlayer = "";
	  while(start == false) {
		  allPlayer = prompt("몇명이서 플레이합니까? (1~4까지의 숫자만 입력가능)");
		  if(allPlayer > 1 && allPlayer < 5){
			  alert("게임시작")
			  $("#diceBtn").attr("disabled", false);
			  start = true;
		  } else {
			  alert("다시입력")
			  start = false;
		  }
	  }
	  //플레이어 수 만큼 돈, 이미지 세팅
	  for(i=1; i <= allPlayer; i++){
		  let playerMoneyHtml = "플레이어"+i+" 돈 : <input type='text' id='player"+i+"money' value='3000000'>";
		  $("#allPlayer").append(playerMoneyHtml);
	  }
	  for(i=1; i <= allPlayer; i++){
		  let playerHtml = "<img class='btn-danger"+i+"' src='/jquery-prac/image/pic0"+i+".jpg'>";
		  $("#btn").append(playerHtml);
	  }
      //주사위 클릭시
      $("#diceBtn").click(function(){
    	//테이블 클릭잠금
    	$(".place").off("click");
      	//$(".place").attr("disabled", true);
    	 //주사위 세팅(1~6까지 숫자 랜덤)
         let ran1 = Math.floor(Math.random()*6+1);
    	 console.log("ran1 : ", ran1);
         let ran2 = Math.floor(Math.random()*6+1);
         console.log("ran2 : ", ran2);
         ran = 30;//ran1+ran2;
         $("#diceValue").val(ran);
    	 $("#player").val(player);
         console.log("gamer : ",player);
         //플레이어 구분
         switch(player){
	        case 1:
	        	gamer = Player1;
	        	console.log("Player1");
	        	break;
	        case 2:
	        	gamer = Player2;
	        	console.log("Player2");
	        	break;
	        case 3:
	        	gamer = Player3;
	        	console.log("Player3");
	        	break;
	        case 4:
	        	gamer = Player4;
	        	console.log("Player4");
	        	break;
         }
            //주사위를 굴렸을때 이동지점
            if(gamer.beforePoint+ran < 41){
            	gamer.afterPoint = gamer.beforePoint+ran;
            } else {
            	gamer.afterPoint = gamer.beforePoint+ran-40;
            }
            //이동지점 내용 입력
            $("#point").val(gamer.afterPoint);
            console.log("gamer.round : ", gamer.round);
          	//이동한 지점에 유저 버튼 생성
            let html = "<img class='btn-danger"+player+"' src='/jquery-prac/image/pic0"+player+".jpg'>";
            gamer.beforeId = "#p"+gamer.beforePoint;
            gamer.afterId = "#p"+gamer.afterPoint;
            console.log("gamer.afterId : ", gamer.afterId);
            
            //현재위치가 무인도일때
            if(gamer.beforePoint == 11){
            	gamer.round = island(gamer, ran1, ran2);
            }
          	//현재위치가 우주여행일때
            if(gamer.beforePoint == 31){
            	console.log("우주여행 시작!");
            	$(".place").on("click", function(){
            		console.log("우주여행 클릭!");
            		gamer.beforeId = "#p" + gamer.beforePoint;
            		console.log("우주여행 gamer.beforePoint", gamer.beforePoint);
            		gamer.afterPoint = $(this).find(".placePoint").text();
            		gamer.afterId = "#p" + gamer.afterPoint;
            		console.log("우주여행 gamer.afterPoint", gamer.afterPoint);
            		$(gamer.beforeId).find(".btn-danger"+gamer.player).remove();
            		$(this).append("<img class='btn-danger"+gamer.player+"' src='/jquery-prac/image/pic0"+gamer.player+".jpg'>");
            		gamer.beforePoint = parseInt(gamer.afterPoint);
            		gamer.round = 0;
            		return gamer.afterId;
            	});
            	console.log("우주여행 return gamer.afterId : ", gamer.afterId);
            }
            //round 체크
            if(gamer.round == 0){
            	//위치 이동
            	$(gamer.beforeId).find(".btn-danger"+player).remove();
                $(gamer.afterId).append(html);
              	//이동위치를 현재위치로 변경
                gamer.beforePoint = gamer.afterPoint;
            } else {
               	//위치 그대로
               	console.log("round gamer.beforePoint", gamer.beforePoint);
               	gamer.afterId = gamer.beforeId;
            }
            
            //밟은 땅 주인 체크
            if($(gamer.afterId).find(".player").text() == 0){
            	let cityName = $(gamer.afterId).find(".city").text();
            	console.log("cityName : ", cityName);
           		//도시 객체를 저장할 변수 선언
            	let city = "";
            	city = cityNameReturn(cityName);
            	//디버깅
            	console.log("city : ", city);
            	if(city != null){
            		console.log("city player : ",gamer.player);
            		//땅 구매여부를 선택할때까지 주사위 비활성화
                	$("#diceBtn").attr("disabled", true);
                	$("#dialog").dialog({
                		closeOnEscape: false,
                	    open: function(event, ui) {
                	            $(".ui-dialog-titlebar-close", $(this).parent()).hide();
                	    }
                	});
                	if(city == 제주도 || city == 콩코드여객기 || city == 부산 || city == 퀸엘리자베스호 || city == 콜럼비아호 || city == 서울){
                		$("#villaDiv").hide();//attr("disabled", true);
                		$("#buildingDiv").hide();
                		$("#hotelDiv").hide();
                	}
                	$("#landToll").text(" 구매료 "+ city.대지료구매+"원");
                	$("#villaToll").text(" 구매료 "+ parseInt(city.대지료구매+city.별장구매)+"원");
                	$("#buildingToll").text(" 구매료 "+ parseInt(city.대지료구매+city.빌딩구매)+"원");
                	$("#hotelToll").text(" 구매료 "+ parseInt(city.대지료구매+city.호텔구매)+"원");
                	//구매버튼 클릭시 함수 실행
                	$("#buy").click(function(){
                		console.log("buy 클릭 실행!");
                		console.log("buy player : ", gamer.player);
                		//땅 주인 세팅 (플레이어1 이면 1 이 들어감)
                        $(gamer.afterId).find(".player").text(gamer.player);
                		//radio타입 클릭한 내용 찾기 (땅, 별장, 빌딩, 호텔)
                		if($('input[name="build"]:checked').is("#land")){
                          	//주인이없으면 땅 가격 세팅
                          	$(gamer.afterId).find(".gold").text(city.대지료통행시);
                          	console.log("대지료구매 전 머니", gamer.money);
                          	console.log("구매료 : ", city.대지료구매);
                          	gamer.money = gamer.money-city.대지료구매;
                          	console.log("대지료구매 후 머니", gamer.money);
                		}
                		if($('input[name="build"]:checked').is("#villa")){
                            //주인이없으면 별장 가격 세팅
                            $(gamer.afterId).find(".gold").text(city.별장통행시);
                            console.log("별장구매 전 머니", gamer.money);
                            console.log("구매료 : ", city.대지료구매+city.별장구매);
                          	gamer.money = gamer.money-city.대지료구매-city.별장구매;
                          	console.log("별장구매 후 머니", gamer.money);
                		}
                		if($('input[name="build"]:checked').is("#building")){
                            //주인이없으면 빌딩 가격 세팅
                            $(gamer.afterId).find(".gold").text(city.빌딩통행시);
                            console.log("빌딩구매 전 머니", gamer.money);
                            console.log("구매료 : ", city.대지료구매+city.빌딩구매);
                          	gamer.money = gamer.money-city.대지료구매-city.빌딩구매;
                          	console.log("빌딩구매 후 머니", gamer.money);
                		}
                		if($('input[name="build"]:checked').is("#hotel")){
                            //호텔 가격 세팅
                            $(gamer.afterId).find(".gold").text(city.호텔통행시);
                            console.log("호텔구매 전 머니", gamer.money);
                            console.log("구매료 : ", city.대지료구매+city.호텔구매);
                          	gamer.money = gamer.money-city.대지료구매-city.호텔구매;
                          	console.log("호텔구매 후 머니", gamer.money);
                		}
                		$("#player"+gamer.player+"money").val(gamer.money);
                        //주사위 활성화
                		$("#diceBtn").attr("disabled", false);
                        //dialog 닫기
                		$("#dialog").dialog("close");
                	});
                	$("#cancel").click(function(){
                		//dialog 닫기
                		$("#diceBtn").attr("disabled", false);
                		$("#dialog").dialog("close");
                	});
            	} else {
            		event = $(gamer.afterId).find(".event").text();
            		switch(event){
	            		case "황금열쇠":
	            			console.log("황금열쇠 도착!");
	            			break;
	            		case "사회복지기금(내는곳)":
	            			console.log("사회복지기금(내는곳) 도착!");
	            			gamer.money = donateGive(gamer, player);
	            			console.log("donateGamer : ",gamer.money);
	            			console.log("donatePlayer : ", player);
	            			$("#player"+player+"money").val(gamer.money);
	            			break;
	            		case "사회복지기금(받는곳)":
	            			console.log("사회복지기금(받는곳) 도착!");
	            			gamer.money = donateReceive(gamer);
	            			console.log("donateReGamer : ",gamer.money);
	            			$("#player"+player+"money").val(gamer.money);
	            			break;
	            		case "무인도":
	            			console.log("무인도 도착!");
	            			gamer.round+=1;
	            			break;
	            		case "우주여행":
	            			console.log("우주여행 도착!");
	            			gamer.round+=1;
	            			break;
            		}
            	}
            	
            } else {
               //주인이 있으면 땅 가격만큼 가진 돈에서 차감
               console.log("결제 전 머니: ", gamer.money);
               gamer.money = gamer.money-($(gamer.afterId).find(".gold").text());
               console.log("결제 후 머니: ", gamer.money);
               $("#player"+gamer.player+"money").val(gamer.money);
               //밟은 땅 주인에게 돈 추가
               //땅 주인 객체 선언
               let payPlayer = "";
               //땅 주인체크
               landPlayer = parseInt($(gamer.afterId).find(".player").text());
               switch(landPlayer){
               case 1:
	     		    payPlayer = Player1;
	     		    console.log("땅 주인 Player",landPlayer);
	     		    break;
               case 2:
	     			payPlayer = Player2;
	  		    	console.log("땅 주인 Player",landPlayer);
	  		    	break;
               case 3:
	     			payPlayer = Player3;
	  		    	console.log("땅 주인 Player",landPlayer);
	  		    	break;
               case 4:
	     			payPlayer = Player4;
	  		    	console.log("땅 주인 Player",landPlayer);
	  		    	break;
               }
               console.log("통행료 받기 전 머니 : ", payPlayer.money);
               payPlayer.money = payPlayer.money + parseInt($(gamer.afterId).find(".gold").text());
               console.log("통행료 받기 후 머니 : ", payPlayer.money);
               $("#player"+landPlayer+"money").val(payPlayer.money);
            }
          	//더블을 확인하는 함수
            player = doubleDice(ran1, ran2, player, allPlayer);
            console.log("-----------------------");
      });
   });
</script>
</html>